<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Online-Reservation-System/cancel</title>
</head>

<body bgcolor="beige">
	<h1 style="text-align: center; color: darkblue; position: absolute; top: 10%; left: 40%;">Your Reservation Details
	</h1>
	<form th:action="@{/cancel}" method="POST" th:if="${reservationDetails != null}">
		<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Online-Reservation-System/cancel</title>
</head>

<body bgcolor="beige">
    <h1 style="text-align: center; color: darkblue; position: absolute; top: 10%; left: 40%;">Your Reservation Details
    </h1>
    <form th:action="@{/cancel}" method="POST" th:if="${reservationDetails != null}">
        <table style="border-collapse: separate; 
                          width: 80%; 
                          margin: 5% auto; 
                          text-align: center;
                          position: absolute; 
                          top: 20%; 
                          left: 10%;
                          background-color: white; 
                          color: black;">
			<thead>
				<tr>
					<th>PNR</th>
					<th>Passenger name</th>
					<th>DOB</th>
					<th>Ph Number</th>
					<th>Email</th>
					<th>Address</th>
					<th>Class Type</th>
					<th>From</th>
					<th>To</th>
					<th>Train Name</th>
					<th>Train Number</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="reservationDetail : ${reservationDetails}">
					<input type="hidden" name="pnr" th:value="${reservationDetail.pnr}" />
					<td th:text="${reservationDetail.pnr}"></td>
					<td th:text="${reservationDetail.name}"></td>
					<td th:text="${#dates.format(reservationDetail.DOB, 'dd-MMM-yyyy')}"></td>
					<td th:text="${reservationDetail.phoneNumber}"></td>
					<td th:text="${reservationDetail.email}"></td>
					<td th:text="${reservationDetail.address}"></td>
					<td th:text="${reservationDetail.classType}"></td>
					<td th:text="${reservationDetail.fromDestination}"></td>
					<td th:text="${reservationDetail.toDestination}"></td>
					<td th:text="${reservationDetail.trainName}"></td>
					<td th:text="${reservationDetail.trainNumber}"></td>
				</tr>
			</tbody>
		</table>
		<button type="submit" name="confirmCancellation" value="yes" style="font-size: 20px; position: absolute; top: 45%; left: 41%; text-decoration: none;
            padding: 5px; background-color: green; 
            color: white; border-radius: 5px;">Yes, cancel</button>
        <button type="submit" name="confirmCancellation" value="no" style="font-size: 20px; position: absolute; top: 45%; left: 50%; text-decoration: none;
            padding: 5px; background-color: red; 
            color: white; border-radius: 5px;">No, do not cancel</button>    
</form>

    <div th:if="${invalidPnr}" id="error-message" style="color: red; text-align: center; font-size: 18px; display: none;">
        Invalid PNR. Redirecting...
    </div>

    <script th:if="${invalidPnr}">
        /*<![CDATA[*/
        document.getElementsByName("pnr")[0].value = '';
        document.getElementById("error-message").style.display = "block";
        setTimeout(function() {
            console.log('Redirecting...');
            window.location.href = '/cancelReservation';
        }, 1000);
        /*]]>*/
    </script>
</body>

</html>
	</form>
 <script th:if="${invalidPnr}">
        /*<![CDATA[*/
        document.getElementsByName("pnr")[0].value = '';
        alert('Invalid PNR. Redirecting...');
        console.log('Redirecting...');
        window.location.href = '/cancelReservation';
        /*]]>*/
    </script>
</body>

</html>